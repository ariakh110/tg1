# PRD — پلتفرم بازارگاه آهن‌آلات و خدمات صنعتی

- **نسخه:** 1.0
- **تاریخ:** 2026-01-02
- **محصول:** Marketplace خرید/فروش آهن‌آلات + خدمات (برش، حمل، QC)
- **Backend:** Django / DRF
- **Frontend:** Next.js

---

## 1) خلاصه (Executive Summary)

این پلتفرم یک بازارگاه آنلاین B2B برای صنعت آهن‌آلات است که به خریداران امکان می‌دهد:

1) درخواست خرید کالا (RFQ) ثبت کنند و از چند فروشنده پیشنهاد قیمت دریافت کنند؛  
2) از بین «اعلام فروش/بار»های ثبت‌شده توسط فروشندگان، انتخاب و خرید کنند؛  
3) برای خدمات صنعتی مرتبط (برشکاری، حمل‌ونقل، کنترل کیفیت و ...) سفارش ثبت کنند؛  
4) پرداخت‌ها را به صورت مرحله‌ای و امن (Escrow) انجام دهند؛  
5) کل فرآیند را با وضعیت‌های شفاف پیگیری کنند.

هدف، دیجیتال‌کردن فرآیندهای سنتی معامله آهن‌آلات و خدمات وابسته، کاهش ریسک و افزایش سرعت/شفافیت است.

---

## 2) مسئله (Problem)

معامله آهن‌آلات در بسیاری از بازارها با مشکلاتی مانند موارد زیر همراه است:

- کشف قیمت دشوار و زمان‌بر (تماس‌های متعدد، قیمت‌های غیرشفاف)
- ریسک کلاه‌برداری/عدم موجودی/عدم تحویل
- پرداخت‌های سنگین با محدودیت‌های بانکی و عدم اعتماد بین طرفین
- وابستگی به واسطه‌ها
- هماهنگی لجستیک (حمل) و خدمات (برش، QC) پراکنده و غیرمتمرکز
- نبود رهگیری و وضعیت شفاف از سفارش

---

## 3) اهداف محصول (Goals)

### 3.1) اهداف MVP

- امکان ثبت درخواست خرید کالا (BUY) و دریافت پیشنهاد (Offer)
- امکان ثبت اعلام فروش کالا (SELL) و دریافت پیشنهاد خرید
- امکان ثبت سفارش خدمات (CUT/SHIP/QC) و دریافت پیشنهاد/پذیرش
- انتخاب طرف مقابل توسط مالک سفارش (BUY/SELL)
- پرداخت بیعانه و پرداخت مرحله‌ای + ثبت وضعیت پرداخت
- تایید موجودی توسط فروشنده
- مدیریت وزن نهایی و تسویه نهایی (برای BUY)
- وضعیت‌های استاندارد و قابل پیگیری برای سفارش‌ها
- احراز هویت (KYC) برای نقش‌های حرفه‌ای
- سیستم امتیازدهی ساده پس از تکمیل سفارش

### 3.2) اهداف فازهای بعد

- سفارش ترکیبی (COMBO) با ایجاد خودکار زیرسفارش‌ها
- پیشنهاد هوشمند/رتبه‌بندی ارائه‌دهندگان
- رهگیری لحظه‌ای حمل (GPS)
- کیف پول داخلی و refund خودکار
- مرکز حل اختلاف (Dispute Center)
- قیمت‌گذاری نیمه‌خودکار حمل (distance-based estimation)

---

## 4) موارد خارج از محدوده (Out of Scope) — MVP

- پرداخت با چک و اعتباری (credit terms)
- مزایده عمومی با نمایش قیمت پیشنهادها به رقبا
- رهگیری لحظه‌ای GPS
- چند فروشنده برای یک سفارش BUY (split fulfillment)
- سیستم انبارداری کامل و مدیریت موجودی real-time
- قراردادهای حقوقی پیچیده و امضای دیجیتال رسمی (در MVP فقط پذیرش شرایط)

---

## 5) پرسونای کاربران (Personas)

### 5.1) خریدار سازمانی (Buyer)
- شرکت ساختمانی/کارگاه تولیدی
- نیاز: خرید سریع با قیمت مناسب، زمان‌بندی تحویل، کاهش ریسک

### 5.2) فروشنده/انباردار (Seller)
- تامین‌کننده با چند انبار
- نیاز: دریافت سفارش‌های جدید، ارائه قیمت رقابتی، کاهش لغو

### 5.3) ارائه‌دهنده خدمات برش (Cutter)
- کارگاه برش با ظرفیت مشخص
- نیاز: دریافت سفارش‌های مناسب شهر/منطقه، تسویه مطمئن

### 5.4) راننده/باربری (Driver/Carrier)
- راننده مستقل یا شرکت حمل
- نیاز: دریافت مسیرهای مناسب، پرداخت امن، اطلاعات بار

### 5.5) کارشناس QC
- متخصص کنترل کیفیت
- نیاز: درخواست‌های بازرسی محلی، ثبت گزارش استاندارد، پرداخت امن

### 5.6) ادمین
- تیم پشتیبانی/عملیات
- نیاز: کنترل KYC، نظارت روی معاملات، مدیریت ریسک و اختلاف

---

## 6) جریان‌های کلیدی (Core Workflows)

### 6.1) جریان BUY (خرید کالا)

**گام‌ها**
1) Buyer یک RFQ ایجاد می‌کند (مشخصات کالا، مقدار، مقصد، زمان)
2) Sellers پیشنهاد قیمت ارسال می‌کنند
3) Buyer یک پیشنهاد را انتخاب می‌کند
4) Buyer بیعانه پرداخت می‌کند
5) Seller موجودی را تایید می‌کند
6) Buyer پرداخت‌های مرحله‌ای را انجام می‌دهد
7) Seller بار را آماده می‌کند
8) وزن نهایی ثبت می‌شود
9) Buyer مابه‌التفاوت/تسویه نهایی را پرداخت می‌کند
10) حمل انجام می‌شود (با پلتفرم یا بیرون)
11) Buyer تحویل را تایید می‌کند
12) Review/Rating

**Acceptance Criteria**
- Buyer فقط پیشنهادهای مربوط به سفارش خود را می‌بیند
- Seller پیشنهادهای رقبا را نمی‌بیند
- بعد از پرداخت بیعانه، سفارش بدون تایید موجودی فروشنده جلو نمی‌رود
- تغییر وضعیت‌ها ثبت تاریخچه دارد
- پرداخت‌ها قابل پیگیری‌اند و هر پرداخت یک شناسه دارد

### 6.2) جریان SELL (اعلام فروش کالا)

**گام‌ها**
1) Seller اعلام فروش/بار ایجاد می‌کند (مشخصات کالا، مقدار، مبدا، شرایط)
2) Buyers پیشنهاد خرید ارسال می‌کنند
3) Seller یک پیشنهاد را انتخاب می‌کند
4) Buyer بیعانه پرداخت می‌کند
5) Seller موجودی/آمادگی تحویل را تایید می‌کند
6) پرداخت‌های مرحله‌ای/نهایی انجام می‌شود
7) حمل انجام می‌شود
8) Buyer تحویل را تایید می‌کند
9) Review/Rating

**Acceptance Criteria**
- Seller فقط پیشنهادهای مربوط به اعلام فروش خود را می‌بیند
- Buyers پیشنهادهای رقبا را نمی‌بینند
- پس از انتخاب خریدار، قواعد پرداخت/وضعیت مشابه BUY اعمال می‌شود

### 6.3) جریان CUT (برشکاری)

- Buyer درخواست CUT ثبت می‌کند (نقشه، تعداد، محل انجام)
- Cutter پیشنهاد می‌دهد
- Buyer انتخاب + پرداخت
- Cutter انجام + ثبت خروجی/تصاویر
- Buyer تایید + تسویه نهایی (در صورت مرحله‌ای)

### 6.4) جریان SHIP (حمل)

- Buyer یا Seller درخواست SHIP ثبت می‌کند
- Driver پیشنهاد می‌دهد یا قبول فوری می‌کند (configurable)
- هزینه حمل پرداخت/hold می‌شود
- Driver pickup → in transit → delivered
- Buyer تایید تحویل

### 6.5) جریان QC

- Buyer درخواست QC ثبت می‌کند
- QC پیشنهاد می‌دهد
- Buyer انتخاب + پرداخت
- QC گزارش ثبت می‌کند
- Buyer گزارش را می‌بیند و تصمیم می‌گیرد ادامه دهد/لغو کند (طبق سیاست)

### 6.6) جریان COMBO (فاز بعد یا نیمه‌خودکار)

- Order اصلی COMBO ایجاد می‌شود
- زیرسفارش‌ها: BUY + CUT + SHIP (و QC)
- هر زیرسفارش lifecycle خودش را دارد و در UI یک view یکپارچه دارد

---

## 7) نیازمندی‌های عملکردی (Functional Requirements)

### 7.1) مدیریت کاربر و نقش‌ها

- ثبت‌نام و ورود
- امکان داشتن چند نقش
- پروفایل نقش‌محور (SellerProfile, DriverProfile, ...)
- KYC:
  - بارگذاری مدارک
  - وضعیت بررسی (pending/approved/rejected)
  - نقش‌های حرفه‌ای فقط پس از approved فعال

### 7.2) سفارش‌ها

- ایجاد سفارش BUY/SELL/CUT/SHIP/QC
- نمایش لیست سفارش‌ها برای Buyer
- نمایش فید اعلام فروش (SELL) برای Buyer
- نمایش فید سفارش‌های مرتبط برای Seller/Cutter/Driver/QC
- تغییر وضعیت‌های مجاز بر اساس role و مرحله
- تاریخچه تغییر وضعیت‌ها (audit)

### 7.3) پیشنهادها (Offers)

- ایجاد پیشنهاد توسط Seller/Provider (برای BUY) و توسط Buyer (برای SELL)
- مشاهده پیشنهادها توسط مالک سفارش (BUY: Buyer، SELL: Seller)
- انتخاب پیشنهاد توسط مالک سفارش
- بستن سفارش برای پیشنهادهای دیگر پس از انتخاب

### 7.4) پرداخت‌ها

- ایجاد پرداخت (deposit/installment/final)
- callback پرداخت و ثبت وضعیت success/fail
- escrow logical:
  - hold
  - release
  - refund (در صورت لغو)
- نمایش رسید و سوابق پرداخت

### 7.5) لجستیک

- ثبت آدرس مبدا/مقصد
- تعیین زمان pickup
- وضعیت‌های حمل

### 7.6) QC Reports

- فرم گزارش ساختاریافته
- امکان پیوست فایل
- نمایش به Buyer

### 7.7) امتیازدهی

- پس از تکمیل، امکان ثبت Review
- نمایش میانگین امتیاز در پروفایل

### 7.8) اعلان‌ها

- اعلان پیشنهاد جدید
- اعلان انتخاب شدن
- اعلان سررسید پرداخت
- اعلان تغییر وضعیت

---

## 8) قوانین کسب‌وکار (Business Rules)

### 8.1) قیمت‌گذاری

- مدل اصلی: پیشنهاد رقابتی (RFQ)
- پیشنهادها فقط برای مالک سفارش قابل مشاهده‌اند (BUY: Buyer، SELL: Seller)

### 8.2) پرداخت مرحله‌ای

- جدول پرداخت به عنوان بخشی از Offer ذخیره می‌شود
- عدم پرداخت در مهلت → وضعیت delayed و امکان لغو

### 8.3) تایید موجودی فروشنده

- تا قبل از تایید موجودی، سفارش وارد فاز پرداخت‌های بزرگ‌تر نمی‌شود
- عدم تایید در مهلت → لغو + refund

### 8.4) وزن نهایی

- ثبت وزن نهایی توسط Seller یا Driver (با امکان تایید Admin)
- محاسبه مابه‌التفاوت و صدور فاکتور نهایی

### 8.5) لغو و بازگشت وجه

- قبل از انتخاب پیشنهاد: لغو بدون جریمه
- بعد از انتخاب و قبل از بیعانه: لغو با سیاست قابل تنظیم
- بعد از بیعانه: سیاست جریمه/ضبط بخشی از بیعانه (قابل تنظیم) + escrow rules
- لغو توسط Seller به علت عدم موجودی: refund کامل + ثبت تخلف

---

## 9) نیازمندی‌های غیرعملکردی (NFR)

- **امنیت**: HTTPS، JWT، RBAC، Object permissions، rate limit، safe file access
- **کارایی**: list endpoints با pagination و ایندکس مناسب
- **پایداری**: حداقل 99.5% uptime برای MVP
- **مقیاس‌پذیری**: جداکردن workerها و queue
- **ممیزی**: لاگ تغییر وضعیت و تراکنش‌های مالی
- **حریم خصوصی**: محدودسازی داده‌های KYC و اطلاعات تماس

---

## 10) شاخص‌های موفقیت (KPIs)

- GMV (Gross Merchandise Value)
- تعداد سفارش‌های BUY/SELL ثبت‌شده در روز/هفته
- میانگین زمان دریافت اولین پیشنهاد
- نرخ تبدیل: RFQ → offer selected → deposit paid → completed
- نرخ لغو و علت‌ها
- درصد تحویل به‌موقع
- نرخ dispute (در فازهای بعد)

---

## 11) رویدادهای تحلیلی (Analytics Events)

- `order_created` (type, city)
- `offer_submitted` (type, response_time)
- `offer_accepted`
- `payment_initiated` / `payment_succeeded` / `payment_failed`
- `order_status_changed`
- `delivery_confirmed`
- `review_submitted`

---

## 12) ریسک‌ها و کاهش ریسک (Risks)

- **عدم اعتماد کاربران** → escrow + badge تایید + review
- **محدودیت‌های پرداخت** → پرداخت مرحله‌ای
- **اختلافات** → لاگ دقیق + ابزار admin
- **کیفیت ارائه‌دهندگان** → KYC + rating + policy
- **تقلب در وزن نهایی** → ثبت سند/تصویر باسکول + امکان تایید admin

---

## 13) وابستگی‌ها (Dependencies)

- سرویس پرداخت و قابلیت callback
- سرویس SMS/Email
- object storage برای فایل‌ها
- تیم عملیات برای بررسی KYC و رسیدگی به اختلافات (حتی در MVP)

---

## 14) Roadmap پیشنهادی

### فاز 0 (2–4 هفته)
- Auth + User + Roles + KYC minimal
- BUY/SELL order + Offers + Accept
- Payment deposit + status

### فاز 1 (4–8 هفته)
- Installments + final weight + settlement
- CUT/SHIP/QC order types
- Notifications + reviews

### فاز 2
- COMBO order + auto sub-orders
- Dispute center + wallet/refund automation
- Logistics tracking
